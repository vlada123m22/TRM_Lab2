<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Magical Garden - AR Experience</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        
        #ui-overlay {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            text-align: center;
            pointer-events: none;
            max-width: 90vw;
        }
        
        #story-panel {
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(147, 51, 234, 0.5);
        }
        
        #story-title {
            font-size: 18px;
            font-weight: bold;
            color: #a78bfa;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(167, 139, 250, 0.5);
        }
        
        #story-text {
            font-size: 14px;
            line-height: 1.4;
            color: #e0e7ff;
        }
        
        #progress-bar {
            margin-top: 10px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(236, 72, 153, 0.5);
        }
        
        .interaction-hint {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(167, 139, 250, 0.9);
            color: #fff;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            pointer-events: none;
            animation: pulse 2s infinite;
            z-index: 998;
            display: none;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }
        
        #debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 10px;
            font-size: 11px;
            border-radius: 5px;
            z-index: 1000;
            font-family: monospace;
            max-height: 60px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- UI Overlay -->
    <div id="ui-overlay">
        <div id="story-panel">
            <div id="story-title">âœ¨ The Magical Garden âœ¨</div>
            <div id="story-text">Point your camera at the first marker to begin your journey...</div>
            <div id="progress-bar">
                <div id="progress-fill"></div>
            </div>
        </div>
    </div>
    
    <div id="interaction-hint" class="interaction-hint">ðŸ‘† Tap the glowing seed!</div>
    
    <!-- Debug Info -->
    <div id="debug-info">Initializing AR... Please wait...</div>

    <!-- AR Scene -->
    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium; antialias: true;"
        embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono; patternRatio: 0.75; sourceWidth:640; sourceHeight:480; displayWidth: 640; displayHeight: 480;">
        
        <!-- Camera with wider field of view -->
        <a-entity camera="fov: 80; zoom: 0.8" look-controls="enabled: false"></a-entity>

        <!-- Marker 1: The Seed -->
        <a-marker 
            id="marker1" 
            type="pattern" 
            url="markers/pattern-marker1.patt" 
            emitevents="true"
            raycaster="objects: .clickable"
            cursor="fuse: false; rayOrigin: mouse">
            
            <!-- Container scaled down significantly -->
            <a-entity id="seed-container" position="0 0 0" scale="0.25 0.25 0.25">
                
                <!-- Base platform for reference -->
                <a-circle position="0 0 0" radius="2" color="#222" opacity="0.3" rotation="-90 0 0"></a-circle>
                
                <!-- Magical Seed -->
                <a-sphere 
                    id="seed"
                    position="0 1.5 0" 
                    radius="1" 
                    color="#8b5cf6"
                    metalness="0.8"
                    roughness="0.2"
                    emissive="#8b5cf6"
                    emissiveIntensity="0.8"
                    class="clickable">
                    <a-animation
                        attribute="rotation"
                        dur="4000"
                        to="0 360 0"
                        easing="linear"
                        repeat="indefinite">
                    </a-animation>
                    <a-animation
                        attribute="position"
                        dur="2000"
                        from="0 1.5 0"
                        to="0 2 0"
                        direction="alternate"
                        easing="ease-in-out"
                        repeat="indefinite">
                    </a-animation>
                </a-sphere>
                
                <!-- Outer glow ring 1 -->
                <a-torus 
                    position="0 1.5 0" 
                    radius="1.5" 
                    radius-tubular="0.05"
                    color="#a78bfa"
                    opacity="0.7"
                    rotation="-90 0 0">
                    <a-animation
                        attribute="scale"
                        dur="2000"
                        from="1 1 1"
                        to="1.4 1.4 1.4"
                        direction="alternate"
                        repeat="indefinite"
                        easing="ease-in-out">
                    </a-animation>
                    <a-animation
                        attribute="opacity"
                        dur="2000"
                        from="0.7"
                        to="0.2"
                        direction="alternate"
                        repeat="indefinite">
                    </a-animation>
                </a-torus>
                
                <!-- Outer glow ring 2 -->
                <a-torus 
                    position="0 1.5 0" 
                    radius="2" 
                    radius-tubular="0.05"
                    color="#a78bfa"
                    opacity="0.5"
                    rotation="-90 0 0">
                    <a-animation
                        attribute="scale"
                        dur="2000"
                        from="1 1 1"
                        to="1.3 1.3 1.3"
                        direction="alternate"
                        repeat="indefinite"
                        easing="ease-in-out"
                        begin="500">
                    </a-animation>
                    <a-animation
                        attribute="opacity"
                        dur="2000"
                        from="0.5"
                        to="0.1"
                        direction="alternate"
                        repeat="indefinite"
                        begin="500">
                    </a-animation>
                </a-torus>
                
                <!-- Bright particles -->
                <a-sphere position="1 1.5 1" radius="0.15" color="#fbbf24" emissive="#fbbf24" emissiveIntensity="1">
                    <a-animation attribute="position" dur="3000" to="1 3 1" direction="alternate" repeat="indefinite"></a-animation>
                </a-sphere>
                <a-sphere position="-1 1.5 1" radius="0.15" color="#fbbf24" emissive="#fbbf24" emissiveIntensity="1">
                    <a-animation attribute="position" dur="3000" to="-1 3 1" direction="alternate" repeat="indefinite" begin="500"></a-animation>
                </a-sphere>
                <a-sphere position="1 1.5 -1" radius="0.15" color="#fbbf24" emissive="#fbbf24" emissiveIntensity="1">
                    <a-animation attribute="position" dur="3000" to="1 3 -1" direction="alternate" repeat="indefinite" begin="1000"></a-animation>
                </a-sphere>
                <a-sphere position="-1 1.5 -1" radius="0.15" color="#fbbf24" emissive="#fbbf24" emissiveIntensity="1">
                    <a-animation attribute="position" dur="3000" to="-1 3 -1" direction="alternate" repeat="indefinite" begin="1500"></a-animation>
                </a-sphere>
                
                <!-- Text label -->
                <a-text 
                    value="The Seed of Wonder" 
                    position="0 4 0" 
                    align="center" 
                    color="#ffffff"
                    width="8"
                    wrap-count="20">
                </a-text>
            </a-entity>
        </a-marker>

        <!-- Marker 2: The Sprout -->
        <a-marker 
            id="marker2" 
            type="pattern" 
            url="markers/pattern-marker2.patt"
            emitevents="true"
            raycaster="objects: .clickable"
            cursor="fuse: false; rayOrigin: mouse">
            
            <a-entity id="sprout-group" visible="false" position="0 0 0" scale="0.25 0.25 0.25">
                <a-circle position="0 0 0" radius="2" color="#222" opacity="0.3" rotation="-90 0 0"></a-circle>
                
                <!-- Growing Plant -->
                <a-cylinder 
                    id="stem"
                    position="0 1 0" 
                    radius="0.2" 
                    height="2" 
                    color="#10b981"
                    class="clickable">
                </a-cylinder>
                
                <a-cone 
                    position="0.5 1.5 0" 
                    radius-bottom="0.5" 
                    radius-top="0.05"
                    height="1" 
                    color="#34d399"
                    rotation="0 0 -60">
                    <a-animation
                        attribute="rotation"
                        dur="3000"
                        to="0 0 -50"
                        direction="alternate"
                        repeat="indefinite"
                        easing="ease-in-out">
                    </a-animation>
                </a-cone>
                
                <a-cone 
                    position="-0.5 1.5 0" 
                    radius-bottom="0.5" 
                    radius-top="0.05"
                    height="1" 
                    color="#34d399"
                    rotation="0 0 60">
                    <a-animation
                        attribute="rotation"
                        dur="3000"
                        to="0 0 50"
                        direction="alternate"
                        repeat="indefinite"
                        easing="ease-in-out">
                    </a-animation>
                </a-cone>
                
                <a-sphere position="0 2.5 0" radius="0.2" color="#fbbf24" emissive="#fbbf24" emissiveIntensity="1">
                    <a-animation attribute="position" dur="2000" to="0.7 3.5 0" direction="alternate" repeat="indefinite"></a-animation>
                </a-sphere>
                
                <a-text 
                    value="The Growing Sprout" 
                    position="0 3.5 0" 
                    align="center" 
                    color="#ffffff"
                    width="8">
                </a-text>
            </a-entity>
        </a-marker>

        <!-- Marker 3: The Bloom -->
        <a-marker 
            id="marker3" 
            type="pattern" 
            url="markers/pattern-marker3.patt"
            emitevents="true"
            raycaster="objects: .clickable"
            cursor="fuse: false; rayOrigin: mouse">
            
            <a-entity id="bloom-group" visible="false" position="0 0 0" scale="0.25 0.25 0.25">
                <a-circle position="0 0 0" radius="2" color="#222" opacity="0.3" rotation="-90 0 0"></a-circle>
                
                <a-cylinder 
                    position="0 1 0" 
                    radius="0.2" 
                    height="2" 
                    color="#10b981">
                </a-cylinder>
                
                <!-- Flower petals -->
                <a-entity id="flower" position="0 2.5 0" class="clickable">
                    <a-sphere position="0.7 0 0" radius="0.5" color="#ec4899" emissive="#ec4899" emissiveIntensity="0.5"></a-sphere>
                    <a-sphere position="-0.7 0 0" radius="0.5" color="#ec4899" emissive="#ec4899" emissiveIntensity="0.5"></a-sphere>
                    <a-sphere position="0 0 0.7" radius="0.5" color="#ec4899" emissive="#ec4899" emissiveIntensity="0.5"></a-sphere>
                    <a-sphere position="0 0 -0.7" radius="0.5" color="#ec4899" emissive="#ec4899" emissiveIntensity="0.5"></a-sphere>
                    <a-sphere position="0.5 0 0.5" radius="0.5" color="#f472b6" emissive="#f472b6" emissiveIntensity="0.5"></a-sphere>
                    <a-sphere position="-0.5 0 0.5" radius="0.5" color="#f472b6" emissive="#f472b6" emissiveIntensity="0.5"></a-sphere>
                    <a-sphere position="0.5 0 -0.5" radius="0.5" color="#f472b6" emissive="#f472b6" emissiveIntensity="0.5"></a-sphere>
                    <a-sphere position="-0.5 0 -0.5" radius="0.5" color="#f472b6" emissive="#f472b6" emissiveIntensity="0.5"></a-sphere>
                    <a-sphere position="0 0 0" radius="0.4" color="#fbbf24" emissive="#fbbf24" emissiveIntensity="1"></a-sphere>
                    
                    <a-animation
                        attribute="rotation"
                        dur="6000"
                        to="0 360 0"
                        easing="linear"
                        repeat="indefinite">
                    </a-animation>
                </a-entity>
                
                <!-- Butterfly -->
                <a-entity id="butterfly" visible="false" position="1.5 4 0">
                    <a-box width="0.6" height="0.15" depth="0.05" color="#fbbf24" position="-0.3 0 0"></a-box>
                    <a-box width="0.6" height="0.15" depth="0.05" color="#fbbf24" position="0.3 0 0"></a-box>
                    <a-sphere radius="0.15" color="#8b5cf6" position="0 0 0.05"></a-sphere>
                    
                    <a-animation
                        attribute="position"
                        dur="4000"
                        to="1.5 5 1"
                        direction="alternate"
                        repeat="indefinite"
                        easing="ease-in-out">
                    </a-animation>
                </a-entity>
                
                <a-text 
                    value="The Magical Bloom" 
                    position="0 5 0" 
                    align="center" 
                    color="#ffffff"
                    width="8">
                </a-text>
            </a-entity>
        </a-marker>
    </a-scene>

    <script>
        // Game State
        const gameState = {
            marker1Found: false,
            marker2Found: false,
            marker3Found: false,
            seedClicked: false,
            sproutClicked: false,
            flowerClicked: false,
            currentStage: 0
        };

        const storyStages = [
            { title: "âœ¨ The Magical Garden âœ¨", text: "Point your camera at the first marker to begin...", progress: 0 },
            { title: "ðŸŒ± Discovery", text: "You found the Seed! Tap it to plant it...", progress: 33 },
            { title: "ðŸŒ¿ Growth", text: "The seed is sprouting! Find the second marker...", progress: 50 },
            { title: "ðŸŒ¸ Transformation", text: "The sprout grows! Tap it to give energy...", progress: 66 },
            { title: "ðŸ¦‹ Bloom", text: "Find the final marker to see the bloom...", progress: 83 },
            { title: "âœ¨ Magic Revealed", text: "The flower bloomed! Tap it to reveal magic...", progress: 100 },
            { title: "ðŸŽ‰ Complete", text: "A butterfly emerges! The cycle of wonder continues...", progress: 100 }
        ];

        function updateStory(index) {
            if (index >= storyStages.length) return;
            const stage = storyStages[index];
            document.getElementById('story-title').textContent = stage.title;
            document.getElementById('story-text').textContent = stage.text;
            document.getElementById('progress-fill').style.width = stage.progress + '%';
            gameState.currentStage = index;
        }

        function showHint() {
            const hint = document.getElementById('interaction-hint');
            hint.style.display = 'block';
            setTimeout(() => hint.style.display = 'none', 4000);
        }

        function log(msg) {
            const debug = document.getElementById('debug-info');
            const time = new Date().toLocaleTimeString();
            debug.innerHTML = `[${time}] ${msg}<br>` + debug.innerHTML;
        }

        // Scene ready
        const scene = document.querySelector('a-scene');
        scene.addEventListener('loaded', () => {
            log('âœ“ AR Scene loaded successfully');
            log('Camera ready. Point at marker 1');
        });

        // Marker 1
        const marker1 = document.getElementById('marker1');
        marker1.addEventListener('markerFound', () => {
            log('âœ“âœ“âœ“ MARKER 1 DETECTED! Seed should be visible!');
            if (!gameState.marker1Found) {
                gameState.marker1Found = true;
                updateStory(1);
                showHint();
            }
        });
        marker1.addEventListener('markerLost', () => {
            log('Marker 1 lost - reposition camera');
        });

        // Seed click
        const seed = document.getElementById('seed');
        seed.addEventListener('click', function() {
            log('âœ“ Seed clicked!');
            if (gameState.marker1Found && !gameState.seedClicked) {
                gameState.seedClicked = true;
                updateStory(2);
                this.parentElement.setAttribute('animation', 'property: scale; to: 0.08 0.08 0.08; dur: 1000');
            }
        });

        // Marker 2
        const marker2 = document.getElementById('marker2');
        marker2.addEventListener('markerFound', () => {
            if (gameState.seedClicked && !gameState.marker2Found) {
                log('âœ“âœ“âœ“ MARKER 2 DETECTED! Sprout visible!');
                gameState.marker2Found = true;
                document.getElementById('sprout-group').setAttribute('visible', true);
                updateStory(3);
                showHint();
            } else if (!gameState.seedClicked) {
                log('âš  Complete Marker 1 first!');
            }
        });

        // Stem click
        const stem = document.getElementById('stem');
        stem.addEventListener('click', function() {
            log('âœ“ Stem clicked!');
            if (gameState.marker2Found && !gameState.sproutClicked) {
                gameState.sproutClicked = true;
                updateStory(4);
                this.parentElement.setAttribute('animation', 'property: scale; to: 0.22 0.22 0.22; dur: 2000');
            }
        });

        // Marker 3
        const marker3 = document.getElementById('marker3');
        marker3.addEventListener('markerFound', () => {
            if (gameState.sproutClicked && !gameState.marker3Found) {
                log('âœ“âœ“âœ“ MARKER 3 DETECTED! Flower visible!');
                gameState.marker3Found = true;
                document.getElementById('bloom-group').setAttribute('visible', true);
                updateStory(5);
                showHint();
            } else if (!gameState.sproutClicked) {
                log('âš  Complete Marker 2 first!');
            }
        });

        // Flower click
        const flower = document.getElementById('flower');
        flower.addEventListener('click', function() {
            log('âœ“ Flower clicked! Butterfly appears!');
            if (gameState.marker3Found && !gameState.flowerClicked) {
                gameState.flowerClicked = true;
                updateStory(6);
                document.getElementById('butterfly').setAttribute('visible', true);
                this.parentElement.setAttribute('animation', 'property: scale; to: 0.25 0.25 0.25; dur: 2000');
            }
        });

        // Mobile touch handling
        let touchStartTime = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartTime = Date.now();
        });

        document.addEventListener('touchend', (e) => {
            const touchDuration = Date.now() - touchStartTime;
            if (touchDuration < 300) { // Quick tap
                const touch = e.changedTouches[0];
                const clickEvent = new MouseEvent('click', {
                    bubbles: true,
                    cancelable: true,
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                document.elementFromPoint(touch.clientX, touch.clientY)?.dispatchEvent(clickEvent);
            }
        });

        // Error handling
        window.addEventListener('error', (e) => {
            log('ERROR: ' + e.message);
        });

        scene.addEventListener('arjs-video-loaded', () => {
            log('âœ“ Camera stream active');
        });
    </script>
</body>
</html>