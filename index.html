<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Magical Garden - AR Experience</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
        }
        
        #ui-overlay {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            text-align: center;
            pointer-events: none;
        }
        
        #story-panel {
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 20px 30px;
            border-radius: 15px;
            max-width: 80vw;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(147, 51, 234, 0.5);
        }
        
        #story-title {
            font-size: 24px;
            font-weight: bold;
            color: #a78bfa;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(167, 139, 250, 0.5);
        }
        
        #story-text {
            font-size: 16px;
            line-height: 1.6;
            color: #e0e7ff;
        }
        
        #progress-bar {
            margin-top: 15px;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        #progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(236, 72, 153, 0.5);
        }
        
        .interaction-hint {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(167, 139, 250, 0.9);
            color: #fff;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            pointer-events: all;
            cursor: pointer;
            animation: pulse 2s infinite;
            z-index: 998;
            display: none;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.05); }
        }
        
        .fade-in {
            animation: fadeIn 1s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        #debug-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 10px;
            font-size: 12px;
            border-radius: 5px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- UI Overlay -->
    <div id="ui-overlay">
        <div id="story-panel" class="fade-in">
            <div id="story-title">âœ¨ The Magical Garden âœ¨</div>
            <div id="story-text">Point your camera at the first marker to begin your journey...</div>
            <div id="progress-bar">
                <div id="progress-fill"></div>
            </div>
        </div>
    </div>
    
    <div id="interaction-hint" class="interaction-hint">ðŸ‘† Tap the object to interact!</div>
    
    <!-- Debug Info -->
    <div id="debug-info">Marker Status: Searching...</div>

    <!-- AR Scene -->
    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium;"
        embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
        
        <!-- Camera -->
        <a-entity camera></a-entity>

        <!-- Marker 1: The Seed (Starting Point) -->
        <a-marker 
            id="marker1" 
            type="pattern" 
            url="markers/pattern-marker1.patt" 
            emitevents="true" 
            cursor="rayOrigin: mouse"
            smooth="true"
            smoothCount="5"
            smoothTolerance="0.01"
            smoothThreshold="2">
            
            <a-entity id="seed-group" position="0 0 0" scale="0.5 0.5 0.5">
                <!-- Magical Seed -->
                <a-sphere 
                    id="seed"
                    position="0 0.5 0" 
                    radius="0.3" 
                    color="#8b5cf6"
                    metalness="0.7"
                    roughness="0.2"
                    emissive="#8b5cf6"
                    emissiveIntensity="0.5"
                    class="clickable">
                    <a-animation
                        attribute="rotation"
                        dur="4000"
                        to="0 360 0"
                        easing="linear"
                        repeat="indefinite">
                    </a-animation>
                    <a-animation
                        attribute="position"
                        dur="2000"
                        direction="alternate"
                        to="0 0.7 0"
                        easing="ease-in-out"
                        repeat="indefinite">
                    </a-animation>
                </a-sphere>
                
                <!-- Glow effect ring -->
                <a-ring 
                    position="0 0.5 0" 
                    radius-inner="0.35" 
                    radius-outer="0.45" 
                    color="#a78bfa"
                    opacity="0.6"
                    rotation="-90 0 0">
                    <a-animation
                        attribute="scale"
                        dur="2000"
                        from="1 1 1"
                        to="1.3 1.3 1.3"
                        direction="alternate"
                        repeat="indefinite">
                    </a-animation>
                    <a-animation
                        attribute="opacity"
                        dur="2000"
                        from="0.6"
                        to="0.2"
                        direction="alternate"
                        repeat="indefinite">
                    </a-animation>
                </a-ring>
                
                <!-- Particle Effects around seed -->
                <a-sphere position="0.3 0.5 0" radius="0.05" color="#fbbf24" opacity="0.8" emissive="#fbbf24" emissiveIntensity="0.8">
                    <a-animation attribute="position" dur="3000" to="0.3 1.0 0" direction="alternate" repeat="indefinite"></a-animation>
                    <a-animation attribute="opacity" dur="3000" from="0.8" to="0.3" direction="alternate" repeat="indefinite"></a-animation>
                </a-sphere>
                <a-sphere position="-0.3 0.5 0" radius="0.05" color="#fbbf24" opacity="0.8" emissive="#fbbf24" emissiveIntensity="0.8">
                    <a-animation attribute="position" dur="3000" to="-0.3 1.0 0" direction="alternate" repeat="indefinite" begin="500"></a-animation>
                    <a-animation attribute="opacity" dur="3000" from="0.8" to="0.3" direction="alternate" repeat="indefinite" begin="500"></a-animation>
                </a-sphere>
                <a-sphere position="0 0.5 0.3" radius="0.05" color="#fbbf24" opacity="0.8" emissive="#fbbf24" emissiveIntensity="0.8">
                    <a-animation attribute="position" dur="3000" to="0 1.0 0.3" direction="alternate" repeat="indefinite" begin="1000"></a-animation>
                    <a-animation attribute="opacity" dur="3000" from="0.8" to="0.3" direction="alternate" repeat="indefinite" begin="1000"></a-animation>
                </a-sphere>
                <a-sphere position="0 0.5 -0.3" radius="0.05" color="#fbbf24" opacity="0.8" emissive="#fbbf24" emissiveIntensity="0.8">
                    <a-animation attribute="position" dur="3000" to="0 1.0 -0.3" direction="alternate" repeat="indefinite" begin="1500"></a-animation>
                    <a-animation attribute="opacity" dur="3000" from="0.8" to="0.3" direction="alternate" repeat="indefinite" begin="1500"></a-animation>
                </a-sphere>
                
                <!-- Text label -->
                <a-text 
                    value="The Seed of Wonder" 
                    position="0 1.2 0" 
                    align="center" 
                    color="#ffffff"
                    width="2">
                </a-text>
            </a-entity>
        </a-marker>

        <!-- Marker 2: The Sprout (Second Stage - Unlocked after Marker 1) -->
        <a-marker 
            id="marker2" 
            type="pattern" 
            url="markers/pattern-marker2.patt"
            emitevents="true" 
            cursor="rayOrigin: mouse"
            smooth="true"
            smoothCount="5"
            smoothTolerance="0.01"
            smoothThreshold="2">
            
            <a-entity id="sprout-group" visible="false" position="0 0 0" scale="0.5 0.5 0.5">
                <!-- Growing Plant -->
                <a-cylinder 
                    id="stem"
                    position="0 0.3 0" 
                    radius="0.05" 
                    height="0.6" 
                    color="#10b981"
                    class="clickable">
                </a-cylinder>
                
                <a-cone 
                    id="leaf1"
                    position="0.15 0.5 0" 
                    radius-bottom="0.15" 
                    radius-top="0.01"
                    height="0.3" 
                    color="#34d399"
                    rotation="0 0 -60">
                    <a-animation
                        attribute="rotation"
                        dur="3000"
                        to="0 0 -50"
                        direction="alternate"
                        repeat="indefinite"
                        easing="ease-in-out">
                    </a-animation>
                </a-cone>
                
                <a-cone 
                    id="leaf2"
                    position="-0.15 0.5 0" 
                    radius-bottom="0.15" 
                    radius-top="0.01"
                    height="0.3" 
                    color="#34d399"
                    rotation="0 0 60">
                    <a-animation
                        attribute="rotation"
                        dur="3000"
                        to="0 0 50"
                        direction="alternate"
                        repeat="indefinite"
                        easing="ease-in-out">
                    </a-animation>
                </a-cone>
                
                <!-- Sparkles -->
                <a-sphere position="0 0.7 0" radius="0.03" color="#fbbf24" emissive="#fbbf24" emissiveIntensity="1">
                    <a-animation attribute="position" dur="2000" to="0.2 0.9 0" direction="alternate" repeat="indefinite"></a-animation>
                </a-sphere>
                
                <a-text 
                    value="The Growing Sprout" 
                    position="0 1.0 0" 
                    align="center" 
                    color="#ffffff"
                    width="2">
                </a-text>
            </a-entity>
        </a-marker>

        <!-- Marker 3: The Bloom (Final Stage - Interactive) -->
        <a-marker 
            id="marker3" 
            type="pattern" 
            url="markers/pattern-marker3.patt"
            emitevents="true" 
            cursor="rayOrigin: mouse"
            smooth="true"
            smoothCount="5"
            smoothTolerance="0.01"
            smoothThreshold="2">
            
            <a-entity id="bloom-group" visible="false" position="0 0 0" scale="0.5 0.5 0.5">
                <!-- Magical Flower -->
                <a-cylinder 
                    position="0 0.3 0" 
                    radius="0.05" 
                    height="0.6" 
                    color="#10b981">
                </a-cylinder>
                
                <!-- Flower petals -->
                <a-entity id="flower" position="0 0.8 0" class="clickable">
                    <a-sphere id="petal1" position="0.2 0 0" radius="0.15" color="#ec4899" emissive="#ec4899" emissiveIntensity="0.3"></a-sphere>
                    <a-sphere id="petal2" position="-0.2 0 0" radius="0.15" color="#ec4899" emissive="#ec4899" emissiveIntensity="0.3"></a-sphere>
                    <a-sphere id="petal3" position="0 0 0.2" radius="0.15" color="#ec4899" emissive="#ec4899" emissiveIntensity="0.3"></a-sphere>
                    <a-sphere id="petal4" position="0 0 -0.2" radius="0.15" color="#ec4899" emissive="#ec4899" emissiveIntensity="0.3"></a-sphere>
                    <a-sphere id="petal5" position="0.14 0 0.14" radius="0.15" color="#f472b6" emissive="#f472b6" emissiveIntensity="0.3"></a-sphere>
                    <a-sphere id="petal6" position="-0.14 0 0.14" radius="0.15" color="#f472b6" emissive="#f472b6" emissiveIntensity="0.3"></a-sphere>
                    <a-sphere id="petal7" position="0.14 0 -0.14" radius="0.15" color="#f472b6" emissive="#f472b6" emissiveIntensity="0.3"></a-sphere>
                    <a-sphere id="petal8" position="-0.14 0 -0.14" radius="0.15" color="#f472b6" emissive="#f472b6" emissiveIntensity="0.3"></a-sphere>
                    <a-sphere position="0 0 0" radius="0.12" color="#fbbf24" emissive="#fbbf24" emissiveIntensity="0.8"></a-sphere>
                    
                    <a-animation
                        attribute="rotation"
                        dur="6000"
                        to="0 360 0"
                        easing="linear"
                        repeat="indefinite">
                    </a-animation>
                </a-entity>
                
                <!-- Butterfly (appears on interaction) -->
                <a-entity id="butterfly" visible="false" position="0.5 1.2 0">
                    <a-box width="0.2" height="0.05" depth="0.02" color="#fbbf24" position="-0.1 0 0"></a-box>
                    <a-box width="0.2" height="0.05" depth="0.02" color="#fbbf24" position="0.1 0 0"></a-box>
                    <a-sphere radius="0.05" color="#8b5cf6" position="0 0 0.02"></a-sphere>
                    
                    <a-animation
                        attribute="position"
                        dur="4000"
                        to="0.5 1.5 0.3"
                        direction="alternate"
                        repeat="indefinite"
                        easing="ease-in-out">
                    </a-animation>
                </a-entity>
                
                <a-text 
                    value="The Magical Bloom" 
                    position="0 1.5 0" 
                    align="center" 
                    color="#ffffff"
                    width="2">
                </a-text>
            </a-entity>
        </a-marker>
    </a-scene>

    <script>
        // Game State Management
        const gameState = {
            marker1Found: false,
            marker2Found: false,
            marker3Found: false,
            seedClicked: false,
            sproutClicked: false,
            flowerClicked: false,
            currentStage: 0
        };

        // Story stages
        const storyStages = [
            {
                title: "âœ¨ The Magical Garden âœ¨",
                text: "Point your camera at the first marker to begin your journey...",
                progress: 0
            },
            {
                title: "ðŸŒ± Discovery",
                text: "You've found the Seed of Wonder! Tap it to plant it in the magical soil...",
                progress: 33
            },
            {
                title: "ðŸŒ¿ Growth",
                text: "The seed is sprouting! Find the second marker to witness its growth...",
                progress: 50
            },
            {
                title: "ðŸŒ¸ Transformation",
                text: "The sprout is reaching for the sky! Tap it to give it energy...",
                progress: 66
            },
            {
                title: "ðŸ¦‹ Bloom",
                text: "Find the final marker to see the magnificent bloom...",
                progress: 83
            },
            {
                title: "âœ¨ Magic Revealed",
                text: "The flower has bloomed! Tap it to reveal its magical secret...",
                progress: 100
            },
            {
                title: "ðŸŽ‰ Journey Complete",
                text: "A butterfly emerges! You've brought magic to the garden. The cycle of wonder continues...",
                progress: 100
            }
        ];

        function updateStory(stageIndex) {
            if (stageIndex >= storyStages.length) return;
            
            const stage = storyStages[stageIndex];
            document.getElementById('story-title').textContent = stage.title;
            document.getElementById('story-text').textContent = stage.text;
            document.getElementById('progress-fill').style.width = stage.progress + '%';
            gameState.currentStage = stageIndex;
        }

        function showInteractionHint() {
            const hint = document.getElementById('interaction-hint');
            hint.style.display = 'block';
            setTimeout(() => {
                hint.style.display = 'none';
            }, 5000);
        }

        function updateDebug(message) {
            document.getElementById('debug-info').textContent = message;
        }

        // Marker 1 Events
        const marker1 = document.getElementById('marker1');
        marker1.addEventListener('markerFound', () => {
            updateDebug('Marker 1 found! âœ“');
            if (!gameState.marker1Found) {
                gameState.marker1Found = true;
                updateStory(1);
                showInteractionHint();
            }
        });

        marker1.addEventListener('markerLost', () => {
            updateDebug('Marker 1 lost - keep marker in view');
        });

        // Seed Click Event
        document.getElementById('seed').addEventListener('click', () => {
            updateDebug('Seed clicked!');
            if (gameState.marker1Found && !gameState.seedClicked) {
                gameState.seedClicked = true;
                updateStory(2);
                
                // Animate seed planting
                const seedGroup = document.getElementById('seed-group');
                seedGroup.setAttribute('animation', {
                    property: 'scale',
                    to: '0.3 0.3 0.3',
                    dur: 1000,
                    easing: 'ease-in'
                });
            }
        });

        // Marker 2 Events
        const marker2 = document.getElementById('marker2');
        marker2.addEventListener('markerFound', () => {
            if (gameState.seedClicked && !gameState.marker2Found) {
                updateDebug('Marker 2 found! âœ“');
                gameState.marker2Found = true;
                document.getElementById('sprout-group').setAttribute('visible', true);
                updateStory(3);
                showInteractionHint();
            } else if (!gameState.seedClicked) {
                updateDebug('Complete Marker 1 first!');
                document.getElementById('story-text').textContent = "You must find and interact with the first marker before this one awakens...";
            }
        });

        marker2.addEventListener('markerLost', () => {
            if (gameState.marker2Found) {
                updateDebug('Marker 2 lost - keep marker in view');
            }
        });

        // Sprout Click Event
        document.getElementById('stem').addEventListener('click', () => {
            updateDebug('Sprout clicked!');
            if (gameState.marker2Found && !gameState.sproutClicked) {
                gameState.sproutClicked = true;
                updateStory(4);
                
                // Animate growth
                const sproutGroup = document.getElementById('sprout-group');
                sproutGroup.setAttribute('animation', {
                    property: 'scale',
                    to: '0.7 0.7 0.7',
                    dur: 2000,
                    easing: 'ease-out'
                });
            }
        });

        // Marker 3 Events
        const marker3 = document.getElementById('marker3');
        marker3.addEventListener('markerFound', () => {
            if (gameState.sproutClicked && !gameState.marker3Found) {
                updateDebug('Marker 3 found! âœ“');
                gameState.marker3Found = true;
                document.getElementById('bloom-group').setAttribute('visible', true);
                updateStory(5);
                showInteractionHint();
            } else if (!gameState.sproutClicked) {
                updateDebug('Complete Marker 2 first!');
                document.getElementById('story-text').textContent = "The final marker awaits, but you must complete the earlier stages first...";
            }
        });

        marker3.addEventListener('markerLost', () => {
            if (gameState.marker3Found) {
                updateDebug('Marker 3 lost - keep marker in view');
            }
        });

        // Flower Click Event
        document.getElementById('flower').addEventListener('click', () => {
            updateDebug('Flower clicked! ðŸ¦‹');
            if (gameState.marker3Found && !gameState.flowerClicked) {
                gameState.flowerClicked = true;
                updateStory(6);
                
                // Reveal butterfly
                const butterfly = document.getElementById('butterfly');
                butterfly.setAttribute('visible', true);
                
                // Flower opening animation
                const bloomGroup = document.getElementById('bloom-group');
                bloomGroup.setAttribute('animation', {
                    property: 'scale',
                    to: '0.8 0.8 0.8',
                    dur: 2000,
                    easing: 'ease-out'
                });
            }
        });

        // Touch/click handling for mobile
        document.addEventListener('touchstart', (e) => {
            // Get touch coordinates
            const touch = e.touches[0];
            const x = touch.clientX;
            const y = touch.clientY;
            
            // Create a synthetic click event
            const clickEvent = new MouseEvent('click', {
                bubbles: true,
                cancelable: true,
                view: window,
                clientX: x,
                clientY: y
            });
            
            // Dispatch to the touched element
            const element = document.elementFromPoint(x, y);
            if (element) {
                element.dispatchEvent(clickEvent);
            }
        });

        // Scene loaded
        document.querySelector('a-scene').addEventListener('loaded', () => {
            updateDebug('AR Ready! Point at marker 1');
        });
    </script>
</body>
</html>