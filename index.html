<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive AR Narrative Experience</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        
        #ui-overlay {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            font-family: Arial, sans-serif;
            text-align: center;
            max-width: 80%;
        }
        
        #story-text {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        #progress {
            font-size: 14px;
            color: #4CAF50;
        }
        
        .fade-in {
            animation: fadeIn 1s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="ui-overlay">
        <div id="story-text">Point your camera at the first marker to begin the journey...</div>
        <div id="progress">Progress: 0/3</div>
    </div>

    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; precision: medium;"
        embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
        
        <!-- First Marker: The Beginning -->
        <a-nft
            id="marker1"
            type="nft"
            url="markers/marker1"
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5">
            
            <!-- Animated Text Panel -->
            <a-entity
                id="panel1"
                position="0 0 0"
                rotation="-90 0 0"
                scale="50 50 50">
                
                <a-plane
                    width="4"
                    height="2"
                    color="#1a1a2e"
                    opacity="0.9">
                </a-plane>
                
                <a-text
                    value="Chapter I: The Discovery"
                    align="center"
                    color="#00d4ff"
                    width="3.5"
                    position="0 0.5 0.01"
                    font="https://cdn.aframe.io/fonts/Exo2Bold.fnt">
                </a-text>
                
                <a-text
                    value="A mysterious artifact awakens..."
                    align="center"
                    color="#ffffff"
                    width="3"
                    position="0 0 0.01">
                </a-text>
                
                <!-- Rotating Crystal -->
                <a-octahedron
                    position="0 -0.5 0.5"
                    radius="0.3"
                    color="#4CAF50"
                    metalness="0.8"
                    roughness="0.2"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
                    animation__scale="property: scale; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 1000">
                </a-octahedron>
            </a-entity>
        </a-nft>
        
        <!-- Second Marker: The Journey (appears after first) -->
        <a-nft
            id="marker2"
            type="nft"
            url="markers/marker2"
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5">
            
            <a-entity
                id="panel2"
                position="0 0 0"
                rotation="-90 0 0"
                scale="50 50 50"
                visible="false">
                
                <a-plane
                    width="4"
                    height="2"
                    color="#2e1a47"
                    opacity="0.9">
                </a-plane>
                
                <a-text
                    value="Chapter II: The Portal"
                    align="center"
                    color="#ff6b6b"
                    width="3.5"
                    position="0 0.5 0.01"
                    font="https://cdn.aframe.io/fonts/Exo2Bold.fnt">
                </a-text>
                
                <a-text
                    value="Click to open the gateway"
                    align="center"
                    color="#ffffff"
                    width="3"
                    position="0 0 0.01">
                </a-text>
                
                <!-- Interactive Sphere Portal -->
                <a-sphere
                    id="portal"
                    position="0 -0.5 0.5"
                    radius="0.4"
                    color="#ff6b6b"
                    opacity="0.7"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 2000"
                    animation__pulse="property: scale; to: 1.3 1.3 1.3; dir: alternate; loop: true; dur: 800"
                    class="clickable">
                    
                    <a-torus
                        position="0 0 0"
                        radius="0.5"
                        radius-tubular="0.05"
                        color="#ffd93d"
                        animation="property: rotation; to: 360 0 0; loop: true; dur: 2000">
                    </a-torus>
                </a-sphere>
            </a-entity>
        </a-nft>
        
        <!-- Third Marker: The Finale -->
        <a-nft
            id="marker3"
            type="nft"
            url="markers/marker3"
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5">
            
            <a-entity
                id="panel3"
                position="0 0 0"
                rotation="-90 0 0"
                scale="50 50 50"
                visible="false">
                
                <a-plane
                    width="4"
                    height="2.5"
                    color="#0f3460"
                    opacity="0.9">
                </a-plane>
                
                <a-text
                    value="Chapter III: Revelation"
                    align="center"
                    color="#6BCB77"
                    width="3.5"
                    position="0 0.8 0.01"
                    font="https://cdn.aframe.io/fonts/Exo2Bold.fnt">
                </a-text>
                
                <a-text
                    value="The truth is revealed..."
                    align="center"
                    color="#ffffff"
                    width="3"
                    position="0 0.3 0.01">
                </a-text>
                
                <!-- Multiple Interactive Elements -->
                <a-entity position="0 -0.5 0.5">
                    <a-box
                        position="-0.6 0 0"
                        width="0.3"
                        height="0.3"
                        depth="0.3"
                        color="#4ECDC4"
                        animation="property: rotation; to: 360 360 0; loop: true; dur: 4000"
                        animation__hover="property: position; to: -0.6 0.3 0; startEvents: mouseenter; pauseEvents: mouseleave"
                        class="clickable">
                    </a-box>
                    
                    <a-cylinder
                        position="0 0 0"
                        radius="0.15"
                        height="0.5"
                        color="#FFE66D"
                        animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
                        animation__bounce="property: position; to: 0 0.3 0; dir: alternate; loop: true; dur: 1000"
                        class="clickable">
                    </a-cylinder>
                    
                    <a-cone
                        position="0.6 0 0"
                        radius-bottom="0.2"
                        radius-top="0"
                        height="0.4"
                        color="#FF6B9D"
                        animation="property: rotation; to: 0 0 360; loop: true; dur: 2000"
                        animation__hover="property: scale; to: 1.5 1.5 1.5; startEvents: mouseenter; pauseEvents: mouseleave"
                        class="clickable">
                    </a-cone>
                </a-entity>
                
                <a-text
                    value="Thank you for experiencing this journey!"
                    align="center"
                    color="#ffffff"
                    width="3"
                    position="0 -1.2 0.01"
                    opacity="0"
                    animation__appear="property: opacity; to: 1; delay: 2000; dur: 2000">
                </a-text>
            </a-entity>
        </a-nft>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // State management
        const state = {
            marker1Found: false,
            marker2Found: false,
            marker3Found: false,
            portalActivated: false,
            progress: 0
        };

        const stories = [
            "Point your camera at the first marker to begin the journey...",
            "The artifact has awakened! Find the second marker to continue...",
            "The portal is ready! Click it to activate, then find the final marker...",
            "Journey complete! You've unlocked all secrets!"
        ];

        function updateUI() {
            document.getElementById('story-text').textContent = stories[state.progress];
            document.getElementById('progress').textContent = `Progress: ${state.progress}/3`;
            document.getElementById('story-text').classList.add('fade-in');
            setTimeout(() => {
                document.getElementById('story-text').classList.remove('fade-in');
            }, 1000);
        }

        // Marker event listeners
        const marker1 = document.getElementById('marker1');
        const marker2 = document.getElementById('marker2');
        const marker3 = document.getElementById('marker3');
        const panel2 = document.getElementById('panel2');
        const panel3 = document.getElementById('panel3');

        marker1.addEventListener('markerFound', function() {
            if (!state.marker1Found) {
                state.marker1Found = true;
                state.progress = 1;
                updateUI();
                
                // Enable second marker after 2 seconds
                setTimeout(() => {
                    panel2.setAttribute('visible', 'true');
                }, 2000);
            }
        });

        marker2.addEventListener('markerFound', function() {
            if (state.marker1Found && !state.marker2Found) {
                state.marker2Found = true;
                state.progress = 2;
                updateUI();
            }
        });

        marker3.addEventListener('markerFound', function() {
            if (state.portalActivated && !state.marker3Found) {
                state.marker3Found = true;
                state.progress = 3;
                updateUI();
            }
        });

        // Portal interaction
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const portal = document.getElementById('portal');
                if (portal) {
                    portal.addEventListener('click', function() {
                        if (state.marker2Found && !state.portalActivated) {
                            state.portalActivated = true;
                            
                            // Visual feedback
                            this.setAttribute('animation__activate', {
                                property: 'scale',
                                to: '2 2 2',
                                dur: 500
                            });
                            
                            setTimeout(() => {
                                panel3.setAttribute('visible', 'true');
                                updateUI();
                            }, 500);
                        }
                    });
                }

                // Add click interactions to final scene objects
                const clickables = document.querySelectorAll('.clickable');
                clickables.forEach(el => {
                    el.addEventListener('click', function() {
                        // Random color change on click
                        const colors = ['#4ECDC4', '#FFE66D', '#FF6B9D', '#95E1D3', '#F38181'];
                        this.setAttribute('color', colors[Math.floor(Math.random() * colors.length)]);
                    });
                });
            }, 2000);
        });

        // Initialize
        updateUI();
    </script>
</body>
</html>